pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df5a <- as.data.frame(pcoa.cent.dataframe)
plot5a <- ggplot(df5a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
nema.2013<- plot5a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (27.0%)") + ylab("PCoA 2 (24.2%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.1, y = 0.31, label = "nematodes-2013")
ggsave("../figures/nema.2013_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/nema.2013_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
# PERMANOVA - 2012 only
new.data.2012 <- subset(new.data, Year == 2012)
adonis.2012 = adonis(new.data.2012[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2012, perm=1000)
adonis.2012
dataREL.dist <- vegdist(new.data.2012[,-c(1:9)], method="bray")
# Added by Mario ######
soil2012 <- soil[soil$Year == 2012, 17:22]
fit <- envfit(pcoa,soil2012,perm=1000)
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #28.9
explainvar2b #10.0
# Principal Coordinates Analysis (Mgmt*Plant) - 2012 only
pcoa.groups <- paste(new.data.2012$Management, new.data.2012$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df9a <- as.data.frame(pcoa.cent.dataframe)
plot9a <- ggplot(df9a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(1,3,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
# PERMANOVA - 2012 only
new.data.2012 <- subset(new.data, Year == 2012)
adonis.2012 = adonis(new.data.2012[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2012, perm=1000)
adonis.2012
dataREL.dist <- vegdist(new.data.2012[,-c(1:9)], method="bray")
# Added by Mario ######
soil2012 <- soil[soil$Year == 2012, 17:22]
fit <- envfit(pcoa,soil2012,perm=1000)
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #28.9
explainvar2b #10.0
# Principal Coordinates Analysis (Mgmt*Plant) - 2012 only
pcoa.groups <- paste(new.data.2012$Management, new.data.2012$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df9a <- as.data.frame(pcoa.cent.dataframe)
plot9a <- ggplot(df9a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(1,3,1,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
#Plot
df9a <- as.data.frame(pcoa.cent.dataframe)
plot9a <- ggplot(df9a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=4, inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=3, inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=5, inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(3,3,3,4,3), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
fit
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(4,4,4,4,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
# PERMANOVA - 2012 only
new.data.2012 <- subset(new.data, Year == 2012)
adonis.2012 = adonis(new.data.2012[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2012, perm=1000)
adonis.2012
dataREL.dist <- vegdist(new.data.2012[,-c(1:9)], method="bray")
# Added by Mario ######
soil2012 <- soil[soil$Year == 2012, 17:22]
fit <- envfit(pcoa,soil2012,perm=1000)
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #28.9
explainvar2b #10.0
# Principal Coordinates Analysis (Mgmt*Plant) - 2012 only
pcoa.groups <- paste(new.data.2012$Management, new.data.2012$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df9a <- as.data.frame(pcoa.cent.dataframe)
plot9a <- ggplot(df9a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(4,4,4,4,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.31, label = "bacteria-2012")
bact.2012
ggsave("../figures/bact.2012_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/bact.2012_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
# Added by Mario ######
soil2013 <- soil[soil$Year == 2013, 17:22]
# Added by Mario ######
soil2013 <- soil[soil$Year == 2013, 17:22]
fit <- envfit(pcoa,soil2013,perm=1000)
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
# Added by Mario ######
soil2013 <- soil[soil$Year == 2013, 17:22]
fit <- envfit(pcoa,soil2013,perm=1000)
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
fit
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
# Added by Mario ######
soil2013 <- soil[soil$Year == 2013, 17:22]
fit <- envfit(pcoa,soil2013,perm=1000)
fit
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #26.2
explainvar2b #13.8
# Principal Coordinates Analysis (Mgmt*Plant) - 2013 only
pcoa.groups <- paste(new.data.2013$Management, new.data.2013$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df10a <- as.data.frame(pcoa.cent.dataframe)
plot10a <- ggplot(df10a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2013<- plot10a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(4,4,4,1,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (26.2%)") + ylab("PCoA 2 (13.8%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.1, y = 0.31, label = "bacteria-2013")
bact.2013
ggsave("../figures/bact.2013_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/bact.2013_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
bact.2013
