pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df6a <- as.data.frame(pcoa.cent.dataframe)
plot6a <- ggplot(df6a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
nema.2012<- plot6a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.25), ylim = c(-0.2, 0.27)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (25.8%)") + ylab("PCoA 2 (17.6%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.27, label = "nematodes-2012")
nema.2012
ggsave("../figures/nema.2012_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/nema.2012_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
nemaREL.2013 <- subset(nemaREL, Year == 2013)
# PERMANOVA  - 2013 only
adonis(nemaREL.2013[,-c(1:9)]~Block+Management*Plant, data=nemaREL.2013)
dataREL.dist <- vegdist(nemaREL.2013[,-c(1:9)], method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #27.0
explainvar2b #24.2
# Principal Coordinates Analysis (Mgmt*Plant) - 2013 only
pcoa.groups <- paste(nemaREL.2013$Management, nemaREL.2013$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
# Updated by AP with env2013 data
env2013 <- read.csv("../data/EnvironronmentalFactors2013.csv", header=TRUE)
soil2013 <- env2013[,(9:14)]
fit <- envfit(pcoa,soil2013,perm=1000, na.rm=TRUE)
fit
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
#Plot
df5a <- as.data.frame(pcoa.cent.dataframe)
plot5a <- ggplot(df5a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
nema.2013<- plot5a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(4,4,1,1,4,4), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.25), ylim = c(-0.2, 0.27)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (27.0%)") + ylab("PCoA 2 (24.2%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.27, label = "nematodes-2013")
nema.2013
ggsave("../figures/nema.2013_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/nema.2013_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
# Updated by AP with env2013 data
env2013 <- read.csv("../data/EnvironronmentalFactors2013.csv", header=TRUE)
soil2013 <- env2013[,(9:14)]
fit <- envfit(pcoa,soil2013,perm=1000, na.rm=TRUE)
fit
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #26.2
explainvar2b #13.8
# Principal Coordinates Analysis (Mgmt*Plant) - 2013 only
pcoa.groups <- paste(new.data.2013$Management, new.data.2013$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
# Updated by AP with env2013 data
env2013 <- read.csv("../data/EnvironronmentalFactors2013.csv", header=TRUE)
soil2013 <- env2013[,(9:14)]
fit <- envfit(pcoa,soil2013,perm=1000, na.rm=TRUE)
fit
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
#Plot
df10a <- as.data.frame(pcoa.cent.dataframe)
plot10a <- ggplot(df10a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2013<- plot10a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(1,1,4,4,1,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.2), ylim = c(-0.15, 0.15)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (26.2%)") + ylab("PCoA 2 (13.8%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.15, y = 0.15, label = "bacteria-2013")
bact.2013
bact.2013<- plot10a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(1,1,4,4,1,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.2), ylim = c(-0.15, 0.15)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (26.2%)") + ylab("PCoA 2 (13.8%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.2, y = 0.15, label = "bacteria-2013")
bact.2013
plot10a <- ggplot(df10a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2013<- plot10a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(1,1,4,4,1,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.2), ylim = c(-0.15, 0.15)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (26.2%)") + ylab("PCoA 2 (13.8%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.17, y = 0.15, label = "bacteria-2013")
bact.2013
ggsave("../figures/bact.2013_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/bact.2013_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
# PERMANOVA - 2012 only
new.data.2012 <- subset(new.data, Year == 2012)
adonis.2012 = adonis(new.data.2012[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2012, perm=1000)
adonis.2012
dataREL.dist <- vegdist(new.data.2012[,-c(1:9)], method="bray")
# Added by Mario ######
#soil2012 <- soil[soil$Year == 2012, 17:22]
#fit <- envfit(pcoa,soil2012,perm=1000)
#fit
#fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #28.9
explainvar2b #10.0
# Principal Coordinates Analysis (Mgmt*Plant) - 2012 only
pcoa.groups <- paste(new.data.2012$Management, new.data.2012$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df9a <- as.data.frame(pcoa.cent.dataframe)
plot9a <- ggplot(df9a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2012<- plot9a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
#geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
#arrow = arrow(length = unit(0.25, "cm")),
#colour="grey20", linetype=c(4,4,4,4,1), inherit.aes = FALSE) +
#geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
#arrow = arrow(length = unit(0.25, "cm")),
#colour="grey20", inherit.aes = FALSE) +
#geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
#size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.2), ylim = c(-0.15, 0.15)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (28.9%)") + ylab("PCoA 2 (10.0%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.17, y = 0.15, label = "bacteria-2012")
bact.2012
ggsave("../figures/bact.2012_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/bact.2012_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
new.data <-cbind(design,dataREL)
# PERMANOVA - 2011 only
new.data.2011 <- subset(new.data, Year == 2011)
adonis.2011 = adonis(new.data.2011[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2011, perm=1000)
adonis.2011
dataREL.dist <- vegdist(new.data.2011[,-c(1:9)], method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #35.7
explainvar2b #8.9
# Added by Mario ######
#soil2011 <- soil[soil$Year == 2011, 17:22]
#fit <- envfit(pcoa,soil2011,perm=1000)
#fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
# Principal Coordinates Analysis (Mgmt*Plant) - 2011 only
pcoa.groups <- paste(new.data.2011$Management, new.data.2011$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
#Plot
df8a <- as.data.frame(pcoa.cent.dataframe)
plot8a <- ggplot(df8a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2011<- plot8a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
#geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
#arrow = arrow(length = unit(0.25, "cm")),
#colour="grey20", linetype=4, inherit.aes = FALSE) +
#geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
#arrow = arrow(length = unit(0.25, "cm")),
#colour="grey20", inherit.aes = FALSE) +
#geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
#size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.2), ylim = c(-0.15, 0.15)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (35.7%)") + ylab("PCoA 2 (8.9%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.17, y = 0.15, label = "bacteria-2011")
bact.2011
ggsave("../figures/bact.2011_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/bact.2011_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
# PERMANOVA - 2013 only
new.data.2013 <- subset(new.data, Year == 2013)
adonis.2013 = adonis(new.data.2013[,-c(1:9)] ~Block+Management*Plant, method = "bray", data = new.data.2013, perm=1000)
adonis.2013
dataREL.dist <- vegdist(new.data.2013[,-c(1:9)], method="bray")
pcoa <- cmdscale(dataREL.dist, k=3, eig=TRUE, add=FALSE)
# Classical (Metric) Multidimensional Scaling; returns PCoA coordinates
# eig=TRUE returns eigenvalues; k = # of dimensions to calculate
explainvar1b <- round(pcoa$eig[1] / sum(pcoa$eig), 3) * 100
explainvar2b <- round(pcoa$eig[2] / sum(pcoa$eig), 3) * 100
sum.eigb <- sum(explainvar1b, explainvar2b)
explainvar1b #26.2
explainvar2b #13.8
# Principal Coordinates Analysis (Mgmt*Plant) - 2013 only
pcoa.groups <- paste(new.data.2013$Management, new.data.2013$Plant, sep = "_")
pcoa.points <- data.frame(pcoa$points, group = pcoa.groups)
# Calculate Centroids (mean and SE)
pcoa.L.centroids <- melt(pcoa.points, id="group", measure.vars = c("X1", "X2"))
pcoa.centroids <- acast(pcoa.L.centroids, variable ~ group, mean)
pcoa.centroids.se <- acast(pcoa.L.centroids, variable ~ group, se)
pcoa.centroids.sd <- acast(pcoa.L.centroids, variable ~ group, sd)
# Combine
pcoa.cent.dataframe <- cbind(t(pcoa.centroids), t(pcoa.centroids.se))
colnames(pcoa.cent.dataframe) <- c("V1", "V2", "V1e", "V2e")
pcoa.cent.treats <- rownames(pcoa.cent.dataframe)
pcoa.col <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 2)) # Management
pcoa.shape <- as.factor(sapply(strsplit(pcoa.cent.treats, "_"), `[`, 1))  # Plant
# Added by Mario ######
#soil2013 <- soil[soil$Year == 2013, 17:22]
#fit <- envfit(pcoa,soil2013,perm=1000)
#fit
#fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
# Updated by AP with env2013 data
env2013 <- read.csv("../data/EnvironronmentalFactors2013.csv", header=TRUE)
soil2013 <- env2013[,(9:14)]
fit <- envfit(pcoa,soil2013,perm=1000, na.rm=TRUE)
fit
fit.coords <- as.data.frame(fit$vectors$arrows) * 0.1
############
#Plot
df10a <- as.data.frame(pcoa.cent.dataframe)
plot10a <- ggplot(df10a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
bact.2013<- plot10a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
# Added By Mario ####
geom_segment(data=fit.coords,aes(x=0,xend=Dim1,y=0,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", linetype=c(1,1,4,4,1,1), inherit.aes = FALSE) +
geom_segment(data=fit.coords,aes(x=Dim1 * 0.98,xend=Dim1,y=Dim2 * 0.98,yend=Dim2),
arrow = arrow(length = unit(0.25, "cm")),
colour="grey20", inherit.aes = FALSE) +
geom_text(data=fit.coords,aes(x=Dim1 * 1.125,y=Dim2 * 1.125, label=rownames(fit.coords)),
size=3, inherit.aes = FALSE) +
####################
scale_colour_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_fill_manual(labels = c("Annual","Perennial"),
values = c("#D55E00", "#0072B2")) +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
coord_cartesian(xlim = c(-0.2, 0.2), ylim = c(-0.15, 0.15)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (26.2%)") + ylab("PCoA 2 (13.8%)") +
labs(fill = "Plant", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black"))) +
annotate("text", x = -0.17, y = 0.15, label = "bacteria-2013")
bact.2013
ggsave("../figures/bact.2013_PlantMgmt.pdf", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
ggsave("../figures/bact.2013_PlantMgmt.png", plot=last_plot(), device=NULL, path=NULL, scale=1, width=NA, height=NA, dpi=900, limitsize=TRUE)
plot1a + theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.line = element_line(colour = "black")) +
theme(panel.background = element_blank()) +
geom_errorbarh(aes(xmax=V1+V1e, xmin=V1-V1e, height=0.01), colour="black") +
geom_errorbar(aes(ymax=V2+V2e, ymin=V2-V2e, width=0.01), colour="black") +
geom_point(aes(fill=pcoa.col), colour = "black", size=6, stroke = 0.75) +
scale_colour_manual(labels = c("2011","2012", "2013"),
values = c("#FFFFFF", "#FFFF00","#336600")) +
scale_fill_manual(labels = c("2011","2012", "2013"),
values = c("#FFFFFF", "#FFFF00","#336600"))  +
scale_shape_manual(labels = c("HighN","LowN","Organic"),
values = c(21, 24, 22)) +
#coord_cartesian(xlim = c(-0.25, 0.5), ylim = c(-0.35, 0.3)) +
theme(axis.title = element_text(size=18), axis.text=element_text(size=14),
axis.text.x = element_text(size=14),
panel.border = element_rect(colour = "black", size=1.25)) +
theme(axis.ticks.length=unit(0.3,"cm")) +
xlab("PCoA 1 (23.1%)") + ylab("PCoA 2 (9.1%)") +
labs(fill = "Date", shape = "Management") +
guides(fill = guide_legend(override.aes = list(pch=21, size = 4, colour="black")),
shape = guide_legend(override.aes = list(size = 4, fill="black")))  +
annotate("text", x = -0.11, y = 0.12, label = "bacteria")
plot1a <- ggplot(df1a, aes(x=V1, y=V2, colour=pcoa.col, shape = pcoa.shape,
group = interaction(pcoa.col, pcoa.shape))) + theme_bw()
